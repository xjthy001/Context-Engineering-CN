# 模块 4: 上下文的细胞 - 赋予 AI 记忆

### 模块概要

默认情况下,AI 的记忆就像金鱼一样;对话回合一结束它就会忘记一切。上下文的"细胞"通过赋予 AI 记忆来解决这个问题。这是通过在每个新回合中将对话历史反馈给模型来实现的。这创建了一个有状态的、连续的交互,允许 AI 记住您说过的话,引用过去的观点,并建立在先前的信息之上。

然而,这个解决方案带来了一个新的关键挑战:AI 的上下文窗口(其短期记忆)是有限的。随着对话变长,您将用完空间。构建上下文细胞的艺术在于有效的记忆管理——选择一种策略来决定 AI "忘记"什么和"记住"什么。掌握这一点是构建从连贯的聊天机器人到可以随时间跟踪信息和进度的复杂有状态应用程序的关键。

### 关键要点

*   **记忆不是自动的:** 您必须手动向 AI 的上下文添加记忆,通常是通过在提示中包含过去的对话历史。
*   **令牌预算问题:** 您添加的每一段记忆都会消耗有限上下文窗口中的宝贵令牌。记忆的核心挑战是管理这个预算。
*   **窗口记忆(最简单):** 这种策略只保留最后 N 个对话回合。它易于实现,但总是会忘记长对话的开头。
*   **摘要记忆(最聪明):** 这涉及使用另一个 AI 调用来总结对话的较旧部分。它更有效地保留信息,但在令牌和时间上成本更高。
*   **键值记忆(最精确):** 这种方法涉及提取特定事实(例如,`user_name: "Alex"`)并将它们存储为结构化数据。它对于记住关键细节非常高效,但需要更复杂的逻辑。
*   **记忆支持应用程序:** 有状态记忆不仅仅用于聊天机器人。它是任何需要跟踪进度、更新变量或建立在先前输出之上的应用程序的基础,例如具有运行总数的计算器。

> **专业提示:** 从最简单的记忆策略开始,该策略适用于您的用例。如果简单的最后 5 个回合的"滑动窗口"足够好,就不要构建复杂的摘要或键值系统。一个好的进程是:
> 1.  从**窗口**开始。
> 2.  如果 AI 忘记了对话早期的关键事实,升级到**摘要**。
> 3.  如果您需要记住跨多个会话的特定结构化数据(如用户偏好),实现**键值存储**。

### 轮到您了:迷你挑战

您的目标是为一个展示记忆的简单有状态应用程序设计上下文。

**任务:**
您正在构建一个充当"运行总数"计算器的 AI 助手。它需要记住当前值并根据用户的命令更新它。

**您的挑战:**
为下面对话的**第三个回合**设计将发送给 AI 的"上下文细胞"。您不需要编写代码,只需提示的完整文本。

*   **回合 1 用户输入:** "从数字 10 开始。"
    *   *(AI 回应: "明白了。当前总数是 10。")*
*   **回合 2 用户输入:** "加 5。"
    *   *(AI 回应: "好的。10 + 5 = 15。当前总数是 15。")*
*   **回合 3 用户输入:** "现在,减 3。"

您设计的上下文应包括:
1.  清晰的**系统提示**,解释 AI 的角色。
2.  表示应用程序**状态**(当前总数)的结构化方式。
3.  **当前用户输入**。

这个练习迫使您思考记忆不仅仅是对话的日志,而是支持应用程序运行的结构化"状态"。
